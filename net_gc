# .NET GC(Environment Variables) ì„¤ì • ì •ë¦¬

ì´ ë¬¸ì„œëŠ” .NET Core 3.1 ~ .NET 8ê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•œ GC(Environment Variables) í™˜ê²½ë³€ìˆ˜ì™€ Kubernetes í™˜ê²½ì—ì„œ ë©”ëª¨ë¦¬ ìµœì í™” ë°©ë²•ì„ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.

---

## ğŸ§  GC ì œì–´ìš© ì£¼ìš” í™˜ê²½ë³€ìˆ˜

| í™˜ê²½ë³€ìˆ˜                              | ì„¤ëª…                                                                                     | ê¸°ë³¸ê°’         |
|----------------------------------------|------------------------------------------------------------------------------------------|----------------|
| **DOTNET_GCHeapHardLimit**             | GC í™ì˜ ìµœëŒ€ í¬ê¸°(ë°”ì´íŠ¸) ì„¤ì •. ì´ˆê³¼ ì‹œ OutOfMemoryException ë°œìƒ                         | ì œí•œ ì—†ìŒ      |
| **DOTNET_GCHeapHardLimitPercent**      | ì „ì²´ ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì˜ í¼ì„¼íŠ¸ë¡œ í™ í¬ê¸° ì œí•œ                                               | ì œí•œ ì—†ìŒ      |
| **DOTNET_GCHeapAffinitizeMask**        | íŠ¹ì • CPU ì½”ì–´ì— GC ìŠ¤ë ˆë“œë¥¼ ê³ ì •                                                         | ìë™           |
| **DOTNET_GCHeapCount**                 | GC í™ ì„¸ê·¸ë¨¼íŠ¸ ìˆ˜ ì§€ì • (Server GCì—ì„œë§Œ ì‚¬ìš©)                                             | ìë™           |
| **DOTNET_GCServer**                    | `1`: Server GC ì‚¬ìš©, `0`: Workstation GC ì‚¬ìš©                                            | ì„œë²„: 1        |
| **DOTNET_GCConcurrent**                | `1`: Concurrent GC ì‚¬ìš©, `0`: ë”                                                        | 1              |
| **DOTNET_GCStress**                    | ìŠ¤íŠ¸ë ˆìŠ¤ ëª¨ë“œ: ëª¨ë“  í• ë‹¹ë§ˆë‹¤ GC ê°•ì œ ì‹¤í–‰. ê°’: 0x1~0xF                                   | ë¹„í™œì„±í™”       |
| **DOTNET_GCHighMemoryPercent**         | ê³ ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ íŒë‹¨í•  ë¹„ìœ¨ ê¸°ì¤€(%)                                                  | 75             |
| **DOTNET_GCHeapVerify**                | GC í™ ê²€ì¦ ëª¨ë“œ í™œì„±í™”. ì„±ëŠ¥ ì €í•˜ ìˆìŒ                                                   | 0              |
| **DOTNET_GCNoAffinitize**              | `1`: GC ìŠ¤ë ˆë“œ CPU ê³ ì • ë„ê¸°                                                             | 0              |
| **DOTNET_GCAllowVeryLargeObjects**     | `1`: 2GB ì´ìƒ ë°°ì—´ í—ˆìš©                                                                  | 0              |

---

## ğŸ”¥ ê³ ê¸‰/ë””ë²„ê¹…ìš© í™˜ê²½ë³€ìˆ˜

| í™˜ê²½ë³€ìˆ˜                              | ì„¤ëª…                                                                                     | ê¸°ë³¸ê°’         |
|----------------------------------------|------------------------------------------------------------------------------------------|----------------|
| **DOTNET_GCRegions**                   | `1`: Large Object Heap(LOH) ì„¸ë¶„í™”                                                       | 0              |
| **DOTNET_GCHoardVM**                   | ê°€ìƒ ë©”ëª¨ë¦¬ ì˜ˆì•½ íŒ¨í„´ ë³€ê²½                                                               | 0              |
| **DOTNET_GCTrimCommit**                | GCê°€ ì‚¬ìš© í›„ ë©”ëª¨ë¦¬ ë°˜í™˜ ì—¬ë¶€ ì œì–´                                                        | 1              |
| **DOTNET_GCLatencyLevel**              | GC ì§€ì—° ë ˆë²¨ ì„¤ì • (Batch/Interactive/SustainedLowLatency ë“±)                              | Interactive    |
| **DOTNET_GCHeapHardLimitSOH**          | Small Object Heap(SOH) ë³„ë„ í™ ìµœëŒ€ê°’(ë°”ì´íŠ¸) ì„¤ì •                                        | ì œí•œ ì—†ìŒ      |
| **DOTNET_GCHeapHardLimitLOH**          | Large Object Heap(LOH) ë³„ë„ í™ ìµœëŒ€ê°’(ë°”ì´íŠ¸) ì„¤ì •                                        | ì œí•œ ì—†ìŒ      |

---

## ğŸ—‚ï¸ Prefix í˜¸í™˜ì„±

- `DOTNET_` prefixì™€ `COMPlus_` prefix ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥
    - âœ… `DOTNET_`: Linux/macOS/Docker ê¶Œì¥
    - âœ… `COMPlus_`: Windows(.exe ì§ì ‘ ì‹¤í–‰ ì‹œ)ì™€ ë™ì¼

ì˜ˆ)
```bash
# ë™ì¼í•œ íš¨ê³¼
export DOTNET_GCHeapHardLimit=1073741824
export COMPlus_GCHeapHardLimit=1073741824



```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dotnet-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dotnet-app
  template:
    metadata:
      labels:
        app: dotnet-app
    spec:
      containers:
        - name: dotnet-app
          image: myregistry/dotnet-app:latest
          ports:
            - containerPort: 8080
          resources:
            limits:
              memory: "3Gi"
              cpu: "1"
            requests:
              memory: "2Gi"
              cpu: "500m"
          env:
            - name: DOTNET_GCHeapHardLimitPercent
              value: "70"
            - name: DOTNET_GCServer
              value: "1" # Server GC ì‚¬ìš©

```
âš ï¸ ì°¸ê³ 
âœ… DOTNET_GCHeapHardLimitPercent

ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ë¦¬ë¯¸íŠ¸(3GiB)ì˜ 70% = 2.1GiBë¡œ GC í™ ì œí•œ

âœ… .NET 6 ì´í›„ëŠ” ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ë¦¬ë¯¸íŠ¸ë¥¼ ìë™ ì¸ì‹í•˜ì§€ë§Œ, ê°•ì œ ì„¤ì • ì‹œ ë” ì•ˆì •ì 

âœ… ë‚˜ë¨¸ì§€ 30%ëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œ, ë¼ì´ë¸ŒëŸ¬ë¦¬, ìŠ¤ë ˆë“œ ìŠ¤íƒì— ì‚¬ìš©

